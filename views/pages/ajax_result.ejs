<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"> 
    <title>Get Data AJAX</title>
    <% include ../partials/header.ejs %>
    <script>
        // This function will get the data and display it to the screen
        function getData() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var dbObj = JSON.parse(this.responseText);
                    dbObj.forEach(function(element){
                        //document.getElementById("demo").appendChild(document.createTextNode(element.id));
                        document.getElementById("modelData").innerHTML += '<form action="/getAFrame" method="get">' 
                            + String(element.name) 
                            + ': ' 
                            + '<input id="link" type="text" name="link" value="' 
                            + String(element.link) 
                            + '" readonly>' + 
                            '<button type="submit">Begin WebVR Experience</button></form>';
                    });
                }
            };
            xhttp.open("GET", "/getData", true);
            xhttp.send();
        }
        // This function will post to insert data into the database
        function postData() {
            let name = document.getElementById("insert_name").value;
            let link = document.getElementById("insert_link").value;
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("postResponse").innerHTML = this.responseText;
                    location.reload();
                }
            };
            xhttp.open("POST", "/postData?name=" + name + "&link=" + link, true);
            xhttp.send();
        }
    </script>
</head>
<body onload="getData()">
    <div class="container">
        <h1>WebVR App Using A-Frame</h1>
        <form action="/getAFrameTest" method="get">
            <button type="submit">A-Frame Test</button>
        </form>
        <br/>
        <div id="modelData">
        </div>
        <br/>
        <!--Send data via a form or send it via AJAX and just get a confirmation that it worked-->
        <form action="/postData" method="post">
            <input id="insert_name" type="text" name="insert_name" placeholder="Enter Name"><br/>
            <textarea id="insert_link" rows="5" cols="50" name="insert_link" placeholder="Enter Link to GLTF File"></textarea><br/>
            <button type="button" onclick="postData()">Add Data - AJAX</button>
        </form>
        <div id="postResponse">
        </div>
    </div>
</body>
</html>